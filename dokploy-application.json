{
  "deployment": {
    "mode": "application",
    "build": {
      "dockerfile": "deployment/Dockerfile",
      "context": ".",
      "target": "production"
    },
    "runtime": {
      "port": 80,
      "healthcheck": {
        "path": "/ready",
        "interval": 30,
        "timeout": 10,
        "retries": 3,
        "start_period": 90
      }
    },
    "resources": {
      "memory": "512Mi",
      "cpu": "0.5",
      "replicas": 1
    },
    "environment": {
      "DJANGO_SECRET_KEY": "${{project.DJANGO_SECRET_KEY}}",
      "DEBUG": "False",
      "DJANGO_SETTINGS_MODULE": "project.settings",
      "DATABASE_URL": "${{project.DATABASE_URL}}",
      "REDIS_URL": "${{project.REDIS_URL}}",
      "DOMAIN": "${{project.DOMAIN}}",
      "ALLOWED_HOSTS": "${{project.DOMAIN}},www.${{project.DOMAIN}},localhost,127.0.0.1",
      "PRIMARY_DOMAIN": "${{project.DOMAIN}}",
      "WAGTAILADMIN_BASE_URL": "https://${{project.DOMAIN}}",
      "WAGTAIL_SITE_NAME": "JCleemann Byg",
      "DEFAULT_FROM_EMAIL": "noreply@${{project.DOMAIN}}",
      "SERVER_EMAIL": "noreply@${{project.DOMAIN}}",
      "DJANGO_SUPERUSER_EMAIL": "${{project.ADMIN_EMAIL}}",
      "DJANGO_SUPERUSER_PASSWORD": "${{project.ADMIN_PASSWORD}}"
    },
    "volumes": [
      {
        "name": "media",
        "path": "/app/media"
      },
      {
        "name": "staticfiles",
        "path": "/app/staticfiles"
      },
      {
        "name": "logs",
        "path": "/app/logs"
      }
    ]
  },
  "services": {
    "postgresql": {
      "image": "postgres:15-alpine",
      "environment": {
        "POSTGRES_DB": "kni_webapp",
        "POSTGRES_USER": "kni_user",
        "POSTGRES_PASSWORD": "${{project.DATABASE_PASSWORD}}"
      },
      "volumes": [
        {
          "name": "postgres_data",
          "path": "/var/lib/postgresql/data"
        }
      ],
      "healthcheck": {
        "command": ["CMD-SHELL", "pg_isready -U kni_user -d kni_webapp"],
        "interval": 10,
        "timeout": 5,
        "retries": 5
      }
    },
    "redis": {
      "image": "redis:7-alpine",
      "command": ["redis-server", "--appendonly", "yes", "--requirepass", "${{project.REDIS_PASSWORD}}"],
      "volumes": [
        {
          "name": "redis_data",
          "path": "/data"
        }
      ],
      "healthcheck": {
        "command": ["CMD", "redis-cli", "--no-auth-warning", "-a", "${{project.REDIS_PASSWORD}}", "ping"],
        "interval": 10,
        "timeout": 5,
        "retries": 3
      }
    }
  }
}